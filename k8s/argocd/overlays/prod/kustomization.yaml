apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: argocd

resources:
- ../../base
- ./resources/scc-rbac.yaml
- ./resources/ingress.yaml
- ./resources/projects.yaml
- ./resources/applications.yaml

patches:
- path: ./patches/argocd-gpg-keys-cm-patch.yaml
- path: ./patches/network-policy-patches.yaml
  target:
    kind: NetworkPolicy
    group: networking.k8s.io
    version: v1
    name: argocd-argocd-applicationset-controller

generators:
- |
  apiVersion: viaduct.ai/v1
  kind: ksops-exec
  metadata:
    name: not-important
  files:
  - ./secrets/deploy-sops-age-key.yaml
  - ./secrets/argocd-secret-patch.yaml
  - ./secrets/argocd-github-repo-creds.yaml
